<!DOCTYPE html>
<html>
<head>
    <title>Vision College LockDown</title>
    <style type="text/css">
        .container {
            background-color: #3f9ad6;
            ;
            box-shadow: 0 0 15px 4px #3f9ad6;
            border-radius: 10px;
            padding-left: 20px;
            padding-right: 20px;
            padding-bottom: 20px;
            margin: 20px;
        }

        input[type=text] {
            padding: 10px;
            border: 0;
            box-shadow: 0 0 15px 4px rgba(198, 65, 65, 0.42);
            border-radius: 10px;
        }

        .textareastuff {
            margin-top: 20px;
            margin-bottom: 20px;
            width: 80%;
            resize: both;
            padding: 10px;
            border: 0;
            box-shadow: 0 0 15px 4px rgba(198, 65, 65, 0.42);
            border-radius: 10px;
            height: 50px;
        }

        .lastMessage {
            /* margin-top: 10px;*/
            margin-bottom: 10px;
            background-color: rgba(230, 39, 35, 0.86);
            color: antiquewhite;
            font-weight: bolder;
            font-size: larger;
            width: 80%;
            resize: both;
            padding: 10px;
            border: 0;
            box-shadow: 0 0 15px 4px rgba(198, 65, 65, 0.42);
            border-radius: 10px;
            height: 20px;
        }

        input[type=button] {
            /* remove default behavior */
            appearance: none;
            -webkit-appearance: none;
            /* usual styles */
            padding: 10px;
            border: none;
            background-color: rgba(230, 39, 35, 0.86);
            color: #fff;
            font-weight: 600;
            border-radius: 5px;
        }

        h1 {
            padding-top: 10px;
            color: #fff;
        }

        scroll-container {
            display: block;
            width: 350px;
            height: 200px;
            overflow-y: scroll;
            scroll-behavior: smooth;
        }
    </style>
</head>
<body style="background-color: red">
    <div class="container">
        <h1>VC LockDown Alert</h1>
        <h2 id="WarningMessageShow">warning message here</h2>
        <input type="text" onchange=hideWarningMessageAdmin() id="Name">
        <input type="text" id="WarningMessageAdmin" display: none>

        <textarea id="message" class="textareastuff" rows="15" cols="33"></textarea><br />
        <textarea id="latestMessage" class="lastMessage" rows="5" cols="33"></textarea>

        <br />
        <input type="button" id="sendmessage" value="Send Message" /><br />

        <scroll-container>
            <ul id="discussion"></ul>
        </scroll-container>
    </div>
    <!--Script references. -->
    <!--Reference the SignalR library. -->
    <script type="text/javascript" src="lib/signalr.min.js"></script>
    <!--Add script to update the page and send messages.-->
    <script type="text/javascript">


        function hideWarningMessageAdmin() {
            var name = document.getElementById("Name").value;
            console.log(name)
            var warningInput = document.getElementById("WarningMessageAdmin");
            if (name == "admin") {

                warningInput.style.display = "block";
                console.log(name + " display shown")
            } else {
                warningInput.style.display = "none";
                console.log(name + " display hidden")
            }

        }


        //DOMContentLoaded event – DOM is ready, so the handler can lookup DOM nodes, initialize the interface.
        document.addEventListener('DOMContentLoaded', function () {

            //get the messages and store to send use in  connection.invoke
            var messageInput = document.getElementById('message');
            var warningInput = document.getElementById('WarningMessageAdmin');

            // Get the user name and store it to prepend to messages.
            var name = prompt('Enter your Name and Room Number:', '');

            document.getElementById("Name").value = name; //pass to name input box



            // Set initial focus to message input box.
            messageInput.focus();

            // Start the connection. The JavaScript for SignalR relies on a few objects from the client-side libraries, such as the connection. Notice you must call the connection’s start method to actually connect.
            var connection = new signalR.HubConnectionBuilder()
                .withUrl('/chat')
                .build();

            // Create a function that the hub can call to broadcast messages. The on method allows the server to call the code in it directly. Here’s where the UI is updated – in this case, simply adding messages to a list item. It’s a good practice to encode the data
            connection.on('broadcastMessage', function (name, message, WarningMessageAdmin) {

                //time to add to list
                var today = new Date();
                var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();

                console.log(WarningMessageAdmin);
                // Html encode display name and message.
                var encodedName = name;
                var encodedMsg = message;
                var encodedWarning = WarningMessageAdmin;

                //create a text element and pass the data to it then pass to text box
                var text = document.createElement('text');

                text.innerHTML = encodedName + "   " + encodedMsg;
                document.getElementById('latestMessage').value = text.innerHTML;

                // Add the message to the page in a List Element
                var liElement = document.createElement('li');
                liElement.innerHTML = time + '&nbsp;&nbsp;<strong>' + encodedName + '</strong>:&nbsp;&nbsp;' + encodedMsg;

                document.getElementById('discussion').prepend(liElement);

                //add the warning message to the relevent boxes

                var warningMessageText = document.createElement('WarningMessageShow');
                warningMessageText.innerHTML = encodedWarning
                // document.getElementById('WarningMessage').value = WarningMessageAdmin;
                document.getElementById("WarningMessageShow").innerHTML = WarningMessageAdmin;//warningMessageText.innerHTML;

            });



            // Transport fallback functionality is now built into start.
            connection.start()
                .then(function () {
                    console.log('connection started');
                    document.getElementById('sendmessage').addEventListener('click', function (event) {
                        // Call the Send method on the hub. To make calls to the server, wire up an event to a button or other UI element, capture the data you want to send, and call the invoke method
                        connection.invoke('send', name, messageInput.value, warningInput.value);

                        // Clear text box and reset focus for next comment.
                        messageInput.value = '';
                        messageInput.focus();
                        event.preventDefault();
                    });
                })
                .catch(error => {
                    console.error(error.message);
                });
        });
    </script>
</body>
</html>
